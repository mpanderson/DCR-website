{% extends "base.html"%}
{% block title%}Distributions{%endblock%}

{% block content %}

    <main style="font-family: Arial">
       <center> <h2>Distributions</h2></center>

      <p>This page contains tools that help researchers with simple visualizations and calculations </p>

      <div style="aling: center;">
          <label for="search-input">Search this page:</label>
          <input type="text" id="search-input" oninput="search()">
      </div>

      <h3><p class="separator"><a >Distributions</a></p>
      </h3>
      
      <script src="https://cdn.jsdelivr.net/npm/jstat@1.9.6/dist/jstat.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


      <body1>
        
        <div class="chartContainer">
            <div style="align-content: inline-flex;">
                <h3>Normal Distribution</h3>
                <label for="meanInput">Mean:</label>
                <input type="number" id="meanInput" step="0.1" value="0" style="width: 80px">
                <label for="stdDevInput">Standard Deviation:</label>
                <input type="number" id="stdDevInput" step="0.1" value="1" min="0.001" style="width: 80px">

              
            
                 <!-- Radio buttons for Compute Area and Compute Percentile options -->
                <div>
                    <input type="radio" id="computeArea" name="computeOption" value="area">
                    <label for="computeArea">Compute Area</label>
      
                    <input type="radio" id="computePercentile" name="computeOption" value="percentile">
                    <label for="computePercentile">Compute Percentile</label>
                </div>

                <!-- Table for Compute Area options -->
              <!-- Table for Compute Area options -->
              <table id="areaOptions" style="display: none; width: 50%;">
                  <tr>
                      <td style="border: none; padding: 0px 0px 0px 100px;"><input type="radio" id="greaterThan" name="areaOption" value="greaterThan" checked></td>
                      <td style="border: none; padding: 0px 0px 0px 0px;">greater than</td>
                      <td style="border: none; padding: 0px 0px 0px 0px;"><input style="width: 80px" type="number" id="zScoreGreaterThan" step="0.1" value="0"></td>
                     <td style="border: none; padding: 0px 0px 0px 0px;"><span></span></td>
                     <td style="border: none; padding: 0px 0px 0px 0px;"><span></span></td>
                      <td style="border: none; padding: 0px 0px 0px 0px;">Area:</td>
                      <td style="border: none; padding: 0px 0px 0px 0px;"><span id="computedAreaGreaterThan"></span></td>
                  </tr>
                
                  <!-- Repeat the same pattern for other rows -->
                  <tr>
                      <td style="border: none; padding: 0px 0px 0px 100px;"><input type="radio" id="lessThan" name="areaOption" value="lessThan"></td>
                      <td style="border: none; padding: 0px 0px 0px 0px;">less than</td>
                      <td style="border: none; padding: 0px 0px 0px 0px;"><input style="width: 80px" type="number" id="zScoreLessThan" step="0.1" value="0"></td>
                     <td style="border: none; padding: 0px 0px 0px 0px;"><span ></span></td>
                     <td style="border: none; padding: 0px 0px 0px 0px;"><span ></span></td>
                      <td style="border: none; padding: 0px 0px 0px 0px;">Area:</td>
                      <td style="border: none; padding: 0px 0px 0px 0px;"><span id="computedAreaLessThan"></span></td>
                  </tr>
                  <!-- Repeat the same pattern for other rows -->
                  
                <tr>
                    <td style="border: none; padding: 0px 0px 0px 100px;">
                        <input type="radio" id="greaterThanB" name="areaOption" value="greaterThanB">
                    </td>
                    <td style="border: none; padding: 0px 0px 0px 0px;">greater than</td>
                    <td style="border: none; padding: 0px 0px 0px 0px;">
                        <input style="width: 80px" type="number" id="zScoreGreaterThanB" step="0.1" value="0">
                    </td>
                    <td style="border: none; padding: 0px 0px 0px 0px;">and less than</td>
                    <td style="border: none; padding: 0px 0px 0px 0px;">
                        <input style="width: 80px" type="number" id="zScoreLessThanB" step="0.1" value="0">
                    </td>
                    <td style="border: none; padding: 0px 0px 0px 0px;">Area:</td>
                    <td style="border: none; padding: 0px 0px 0px 0px;">
                        <span id="computedAreaGreaterThanB"></span>
                    </td>
                </tr>
                <tr>
                    <td style="border: none; padding: 0px 0px 0px 100px;">
                        <input type="radio" id="lessThanT" name="areaOption" value="lessThanT">
                    </td>
                    <td style="border: none; padding: 0px 0px 0px 0px;">less than</td>
                    <td style="border: none; padding: 0px 0px 0px 0px;">
                        <input style="width: 80px" type="number" id="zScoreLessThanT" step="0.1" value="0">
                    </td>
                    <td style="border: none; padding: 0px 0px 0px 0px;">and greater than</td>
                    <td style="border: none; padding: 0px 0px 0px 0px;">
                        <input style="width: 80px" type="number" id="zScoreGreaterThanT" step="0.1" value="0">
                    </td>
                    <td style="border: none; padding: 0px 0px 0px 0px;">Area:</td>
                    <td style="border: none; padding: 0px 0px 0px 0px;">
                        <span id="computedAreaLessThanT"></span>
                    </td>
                </tr>
                  <!-- Add more rows for other options -->
              </table>
              </div>
            <canvas id="myChartNorm" style="width: 30%; height: 30%;"></canvas>
        </div>


        
        <!-- Include jStat.js library -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jstat/1.7.1/jstat.min.js"></script>

        <script>
          // Function to compute area under the normal distribution curve
          function computeNormalDistributionArea(mean, stdDev, zScore) {
            // Using jStat library to compute the cumulative distribution function (CDF)
            return jStat.normal.cdf(zScore, mean, stdDev);
          }

          // Function to update all computed areas based on current mean and stdDev
          function updateAllComputedAreas() {
            // Get user inputs
            var mean = parseFloat(document.getElementById("meanInput").value);
            var stdDev = parseFloat(document.getElementById("stdDevInput").value);

            // Update computed areas for all radio button options
            var radioOptions = document.getElementsByName("areaOption");

            for (var i = 0; i < radioOptions.length; i++) {
              var selectedRadio = radioOptions[i].value;
              var computedAreaElement = document.getElementById("computedArea" + selectedRadio.charAt(0).toUpperCase() + selectedRadio.slice(1));

              if (computedAreaElement) {
                var zScore;
                var computedArea;

                // Handle special cases for "greaterThan" and "greaterThanOrEqual"
                if (selectedRadio === "greaterThan" || selectedRadio === "greaterThanOrEqual") {
                  zScore = parseFloat(document.getElementById("zScore" + selectedRadio.charAt(0).toUpperCase() + selectedRadio.slice(1)).value);
                  computedArea = computeNormalDistributionArea(mean, stdDev, zScore);

                  // Adjust the computed area for "greaterThan" and "greaterThanOrEqual" options
                  if (selectedRadio === "greaterThan" || selectedRadio === "greaterThanOrEqual") {
                    computedArea = 1 - computedArea;
                  }
                  
                }
                  // Handle special case for "greaterThanB"
                  else if (selectedRadio === "greaterThanB") {
                    console.log("Handling greaterThanB");
                    var zScoreGreaterThanB = parseFloat(document.getElementById("zScoreGreaterThanB").value);
                    var zScoreLessThanB = parseFloat(document.getElementById("zScoreLessThanB").value);

                    // Find the min and max values
                    var minZScore = Math.min(zScoreGreaterThanB, zScoreLessThanB);
                    var maxZScore = Math.max(zScoreGreaterThanB, zScoreLessThanB);

                    
                    computedArea = computeNormalDistributionArea(mean, stdDev, maxZScore) - computeNormalDistributionArea(mean, stdDev, minZScore);
                    computedAreaElement = document.getElementById("computedAreaGreaterThanB"); // Corrected ID
                    console.log(computedArea);
                    console.log(computedAreaElement);
                  }

                  // Handle special case for "lessThanT"
                  else if (selectedRadio === "lessThanT") {
                    console.log("Handling lessThanT");
                    var zScoreLessThanT = parseFloat(document.getElementById("zScoreLessThanT").value);
                    var zScoreGreaterThanT = parseFloat(document.getElementById("zScoreGreaterThanT").value);

                    // Find the min and max values
                    var minZScore = Math.min(zScoreLessThanT, zScoreGreaterThanT);
                    var maxZScore = Math.max(zScoreLessThanT, zScoreGreaterThanT);

                    
                    computedArea = computeNormalDistributionArea(mean, stdDev, minZScore) + (1 - computeNormalDistributionArea(mean, stdDev, maxZScore));
                    computedAreaElement = document.getElementById("computedAreaLessThanT"); // Corrected ID
                    console.log(computedArea);
                    console.log(computedAreaElement);
                  }
                // Handle other cases
                else {
                  zScore = parseFloat(document.getElementById("zScore" + selectedRadio.charAt(0).toUpperCase() + selectedRadio.slice(1)).value);
                  computedArea = computeNormalDistributionArea(mean, stdDev, zScore);
                }

                computedAreaElement.textContent = computedArea.toFixed(4); // Adjust the decimal places as needed
              }
            }
          }

          // Attach event listeners to radio buttons
          var radioOptions = document.getElementsByName("areaOption");
          for (var i = 0; i < radioOptions.length; i++) {
            radioOptions[i].addEventListener("change", updateAllComputedAreas);
          }

          // Attach event listener to zScore input elements
          var zScoreInputs = document.querySelectorAll('[id^="zScore"]');
          for (var i = 0; i < zScoreInputs.length; i++) {
            zScoreInputs[i].addEventListener("input", updateAllComputedAreas);
          }

          // Attach event listener to mean and stdDev input elements
          var meanInput1 = document.getElementById("meanInput");
          var stdDevInput1 = document.getElementById("stdDevInput");

          meanInput1.addEventListener("input", updateAllComputedAreas);
          stdDevInput1.addEventListener("input", updateAllComputedAreas);

          // Initial update when the page loads
          updateAllComputedAreas();
        </script>







        <script>
            function createChartNorm() {
                const ctxNorm = document.getElementById('myChartNorm').getContext('2d');
                const myChartNorm = new Chart(ctxNorm, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Normal Distribution',
                            data: [],
                            borderColor: 'rgba(75, 192, 192, 1)',
                            fill: false,
                            pointRadius: [0]  // Hide default points
                        }, {
                            label: '95% Interval',
                            data: [],
                            borderColor: 'rgba(75, 192, 192, 1)',
                            fill: true,
                            pointRadius: [0]  // Hide default points
                        }]
                    },
                    options: {
                        scales: {
                            x: {
                                type: 'linear',
                                position: 'bottom'
                            },
                            y: {
                                type: 'linear',
                                position: 'left'
                            }
                        }
                    }
                });
                return myChartNorm;
            }

            // Create the chart instance
            const myChartNorm = createChartNorm();

            

            // Set up listeners for input changes
            meanInput.addEventListener('input', updateChartNorm);
            stdDevInput.addEventListener('input', updateChartNorm);

            // Initial chart creation (using default values)
            updateChartNorm();
        </script>
        <script>
          function normalDistribution(mu, sd, x) {
               return jStat.normal.pdf(x, mu, sd);
           }

           function generateSequenceNorm(mu, sd, numPoints) {
               const sequence = [];
               const lowerBound = mu - 4 * sd;
               const upperBound = mu + 4 * sd;
               const step = (upperBound - lowerBound) / (numPoints - 1);

               for (let i = 0; i < numPoints; i++) {
                   const value = lowerBound + i * step;
                   sequence.push(value);
               }

               return sequence;
           }

           function updateChartNorm() {
               const meanInput = document.getElementById('meanInput');
               const stdDevInput = document.getElementById('stdDevInput');

             const computeAreaRadio = document.getElementById('computeArea');
             const computePercentileRadio = document.getElementById('computePercentile');

             const areaOptionsTable = document.getElementById('areaOptions');


             let mean = parseFloat(meanInput.value) || 0;
             let standardDeviation = Math.max(parseFloat(stdDevInput.value), 0.001) || 0.001;

             // Ensure that stdDev is not below 0.001
               standardDeviation = Math.max(standardDeviation, 0.001);

             // Check which radio button is selected
             if (computeAreaRadio.checked) {
                 // Compute Area option is selected
                 areaOptionsTable.style.display = 'table';  // Show the table of options
                 // ... (your logic for computing area based on selected options and input values)
             } else {
                 // Hide the table if Compute Area is not selected
                 areaOptionsTable.style.display = 'none';
                 // ... (your logic for other options)
             }

               const generatedSequenceNorm = generateSequenceNorm(mean, standardDeviation, 100);
               const distributionValuesNorm = generatedSequenceNorm.map(x => normalDistribution(mean, standardDeviation, x));

               const lowerPercentile = jStat.normal.inv(0.025, mean, standardDeviation);
               const upperPercentile = jStat.normal.inv(0.975, mean, standardDeviation);

               // Add points at 2.5th and 97.5th percentiles
               const confidenceIntervalPoints = [
                   { x: lowerPercentile, y: normalDistribution(mean, standardDeviation, lowerPercentile) },
                   { x: upperPercentile, y: normalDistribution(mean, standardDeviation, upperPercentile) }
               ];

               // Filter values between lowerPercentile and upperPercentile
               const valuesInRange = distributionValuesNorm.filter(value => value >= lowerPercentile && value <= upperPercentile);

               myChartNorm.data.labels = generatedSequenceNorm.map(x => x.toFixed(2));
               myChartNorm.data.datasets[0].data = distributionValuesNorm;
               myChartNorm.data.datasets[0].pointRadius = [0];  // Hide default points
               myChartNorm.data.datasets[0].pointBackgroundColor = ['red', 'red'];  // Color for confidence interval points
               myChartNorm.data.datasets[0].pointBorderColor = ['red', 'red'];  // Border color for confidence interval points
               myChartNorm.data.datasets[0].pointStyle = ['circle', 'circle'];  // Style for confidence interval points
               myChartNorm.data.datasets[1] = {
                   label: '95% Confidence Interval',
                   data: confidenceIntervalPoints,
                   pointRadius: [6, 6],  // Size of confidence interval points
                   pointBackgroundColor: ['red', 'red'],
                   pointBorderColor: ['red', 'red'],
                   pointStyle: ['circle', 'circle'],
                   showLine: false
               };

               myChartNorm.update();
           }

           const meanInput = document.getElementById('meanInput');
           const stdDevInput = document.getElementById('stdDevInput');

           meanInput.addEventListener('input', updateChartNorm);
           stdDevInput.addEventListener('input', updateChartNorm);

          // Set up listeners for radio button changes
          document.getElementById('computeArea').addEventListener('change', updateChartNorm);
          document.getElementById('computePercentile').addEventListener('change', updateChartNorm);

          // Set up listeners for area option changes
          document.querySelectorAll('input[name="areaOption"]').forEach(option => {
              option.addEventListener('change', updateChartNorm);
          });

           const generatedSequenceNorm = generateSequenceNorm(0, 1, 100);
           const distributionValuesNorm = generatedSequenceNorm.map(x => normalDistribution(0, 1, x));

           const lowerPercentile = jStat.normal.inv(0.025, 0, 1);
           const upperPercentile = jStat.normal.inv(0.975, 0, 1);

           // Add points at 2.5th and 97.5th percentiles
           const confidenceIntervalPoints = [
               { x: lowerPercentile, y: normalDistribution(0, 1, lowerPercentile) },
               { x: upperPercentile, y: normalDistribution(0, 1, upperPercentile) }
           ];

           // Filter values between lowerPercentile and upperPercentile
           const valuesInRange = distributionValuesNorm.filter(value => value >= lowerPercentile && value <= upperPercentile);

          
           // Initial chart creation (using default values)
           updateChartNorm();


        </script>
      </body1>



    

      <body3>
        <div class="chartContainer">
          <div style="align-content: inline-flex;">
             <h3>Exponential Distribution</h3>
            <label for="expBetaInput">Beta (scale):</label>
            <input type="number" id="expBetaInput" step="0.1" value="1" min="0.001" style="width: 80px">
          </div>
          <canvas id="myChartExp"></canvas>
        </div>
      </body3>

      <body5>
        <div class="chartContainer">
          <div style="align-content: inline-flex;">
            <h3>Beta Distribution</h3>
            <label for="betaAlphaInput">Alpha:</label>
            <input type="number" id="betaAlphaInput" step="0.1" value="1" min="0.001" style="width: 80px">
            <label for="betaBetaInput">Beta:</label>
            <input type="number" id="betaBetaInput" step="0.1" value="1" min="0.001" style="width: 80px">
          </div>
          <canvas id="myChartBeta"></canvas>
        </div>
      </body5>

      <body4>
        <div class="chartContainer">
          <div style="align-content: inline-flex;">
             <h3>Gamma Distribution</h3>
            <label for="gamAlphaInput">Alpha:</label>
            <input type="number" id="gamAlphaInput" step="0.1" value="1" min="0.001" style="width: 80px">
            <label for="gamBetaInput">Beta (scale):</label>
            <input type="number" id="gamBetaInput" step="0.1" value="1" min="0.001" style="width: 80px">
          </div>
          <canvas id="myChartGam"></canvas>
        </div>
      </body4>

      <body6>
        <div class="chartContainer">
          <div style="align-content: inline-flex;">
             <h3>Uniform Distribution</h3>
            <label for="unifLowerInput">a:</label>
            <input type="number" id="unifLowerInput" step="0.1" value="0" style="width: 80px">
            <label for="unifUpperInput">b:</label>
            <input type="number" id="unifUpperInput" step="0.1" value="1" style="width: 80px">
          </div>
          <canvas id="myChartUnif"></canvas>
        </div>
      </body6>





























   {% endblock %}